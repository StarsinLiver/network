## 네트워크 개념

## 1. OSI 란?

OSI(Open System Interconnection)는 동일한 통신 수단을 가진 컴퓨터끼리만 통신하는 폐쇄형 시스템이 아닌 다양한 통신이 가능한 디바이스가 서로 의미있는 데이터를 주고받을 수 있도록 표준 프로토콜을 사용하게 하는 개방형 시스템 간의 통신 연결을 의미한다.
여기서 개방형이란 같은 종류의 시스템끼리만 통신이 가능하던 종래와 달리 시스템의 종류나 구현 방법 , 시스템의 규모 등 조건에 제약을 받지 않고 서로 다른 시스템끼리 연결해 통신이 가능하도록 한 것을 말한다. 참조모델은 네트워크 시스템 구성요소들이 서로 결합하는 방법과 구성요소들 사이의 인터페이스에 대한 표준 제시 시스템 간 정보 교환만 다루는 것이 아니라 시스템끼리 어떤 공동의 일을 하기 위한 상호 협력 관계에 잇다.

## 2. OSI 7 계층

OSI 7 계층은 ISO(International Standard Organization , 국제표준화기구) 에서 개발한 모델로, 컴퓨터 네트워크 프로토콜 디자인과 통신을 계층으로 나눠 설명한 것이다. 일반적으로 OSI 7계층 모델이라고 한다.

OSI 7 계층은 프로토콜을 기능별로 정의해 나눈것으로, 각 계층은 하위 계층의 기능만을 이용하고, 상위 계층에게 기능을 제공한다. 여기서 프로토콜 스택이란 프로토콜이 구현된 시스템을 의미하는데, 프로토콜 스택은 하드웨어나 소프트웨어 또는 둘이 혼합된 구성이 될 수 있으며, 일반적으로 하위 계층들은 하드웨어로, 상위 계층들은 소프트웨어로 구현된다

### 1) 응용계층

### 응용계층 (7계층)

응용계층 (Application Layer)은 사용자 인터페이스라고 정의하며, 이 계층에서는 사용자가 인식하고 있는 애플리케이션을 하위 계층인 표현(Presentation) 계층과 상호작용할 수 있는 데이터 스트림을 전달한다

[용도] 응용 프로그램 실행 , 제어 , 접근관리 등

[사용 프로토콜] E-mail , File Transfer , Web Application , File Service , Host Session 등

### 표현 계층

번역을 담당하며 응용 계층에서 하는 데이터 스트림의 형식을 담당하는 역할을 대신 해준다. 이 계층에서는 MIME 인코딩이나 암호화 등과 같은 동작이 이뤄진다. EBCDIC 로 인코딩된 문서 파일은 ASCII로 인코딩된 파일로
바꿔주는것이 예시이다. (응용계층과의 경계가 약간 모호함)

[용도] 각 시스템의 데이터를 표현하는 문법 등

[사용 프로토콜] SMTP , POP , FTP , HTTP , NFS , TELNET 등

### 세션계층 (5계층)

세션 계층(Session Layer) 은 TCP/IP 세션을 생성하거나 없애는 역할을 하며, 양쪽 End to End 간 응용 프로세스는 통신을 유지, 관리하기 위한 방법을 제공한다. 전이중 통신 방식(Full duplex) , 반이중 방식(Half duplex)의 통신과 함께 세션의 유지, 종료 , 재설정등을 수행한다

[용도] 각 시스템의 데이터를 표현하는 문법, TCP 세션 관리 등

[사용 프로토콜] POP/25 , 20/21 , 80 , RPC Protmapper , 23 등

### 2) 데이터 전달 계층

### 전달계층 (4계층)

전달 계층 (Transport Layer) 은 양쪽 사용자들이 유효성과 효율성을 바탕으로 신뢰성이 있는 데이터를 주고받을 수 있게 해주고, 오류를 제어하며, 특정 연결의 유효성을 제어한다. 이 계층에서 사용하는 프로토콜 중에서는 상태 개념(Stateful)의 특성을 가진 프로토콜과 연결 기반의 특성을 가진 프로토콜이 있다. 전달된 패킷들의 전송 유효성을 확인할 수 없는 경우에는 재전송을 요구한다. 대표적인 프로토콜의 예로는 TCP를 들 수 있다.

[용도] 송신자와 수신자 사이의 안전한 전송 확인

[사용 프로토콜] TCP , UDP

### 네트워크 계층 (3계층)

네트워크 계층 (Network Layer)은 데이터를 전달하는 데 있어서 많은 통신상 노드를 지날 때마다 경로를 찾아주는 역할을 하는 계층이다. 다양한 크기를 가진 데이터를 네트워크 경로를 통해 전달하거나 전달하는 과정에서 상위 계층이 요구하는 신뢰성을 제공하기 위해 기능적, 절차적 수단을 제공한다.

네트워크 계층에서는 라우팅, 흐름 제어 , 데이터 분할 , 오류 제어 및 네트워킹등을 수행한다. 네트워크 계층에서의 핵심은 라우팅과 스위칭이라고 할 수 있다. 데이터를 라우팅이나 스위칭을 이용해 연결된 다른 네트워크로 전달함으로써 인터넷과 같은 데이터 통신을 가능하게 만드는 계층이다. 계층적인 구조를 가지고 있으며, 사용자가 네트워크 주소 (IP Address)를 직접 할당할 수 있다.

[용도] 데이터의 정확한 전송을 위한 경로 배정

[사용 프로토콜] IP(Internet Protocol) 버전 4.6

### 데이터링크 계층 (2 계층)

데이터링크 계층(Data Link Layer)운 CRC 기반의 오류 제어를 이용해 신뢰성 있는 전송을 보장하기 위한 계층으로, 흐름 제어를 가능하게 해준다. 네트워크를 통한 데이터를 전달하고 하위계층에서 발생하는 오류를 찾으며, 수정할 수 있는 수단을 제공한다. 데이터링크 계츠에서는 MAC 주소 (MAC Address)라는 네트워크 인터페이스 카드에 고유의 하드웨어 주소를 할당한다. 데이터 링크 계층의 대표적인 프로토콜로는 이더넷을 들 수 있으며, 이 밖에도 HDLC , LLC등과 같은 근거리 네트워크용 프로토콜이 있다. 네트워크 디바이스 중 브릿지나 허브 등이 이 계층에서 동작한다.

[용도] 물리적인 링크를 통해 신뢰성 있는 정보 전달

[사용 프로토콜] SLIP , PPP , 803.2 , SNAP , Ethernet 등

### 물리 계층 (1계층)

물리 계층 (Physical Layer) 은 네트워크 상에서 물리적인 하드웨어 전송기술을 다룬다. 다양한 하드웨어 기술이 물리적 인터페이스로 적용된다. 물리 계층은 OSI 7 계층의 계층 구조에서 가장 다양한 계층이라 할 수 있다. 데이터 링크 사이에서 프레임을 전달하기 위해 물리적인 커넥션(Connection)을 설정하거나 전송 매체에 알맞은 신호 변환 기능을 수행한다.

물리적인 서비스 단계 (Activating , Maintaining , Deactivating)로 상위 계층으로부터 전송된 데이터, 즉 Bit 스트림을 물리적인 매체를 통해 다른 시스템으로 전송하는 서비스를 수행한다.
기계적, 전기적, 기능적, 절차적 방법을 통해 물리적 매체에 액서스한다. 물리계층은 타임 동기화와 1계층과 2계층 사이의 인터페이스 역할을 한다.

[용도] 물리 매체를 통해 실제적인 데이터를 Bit 스트림으로 전송, 데이터 송수신, 하드웨어적인 연결 방법 제공

[사용 프로토콜] RS232, RS422 , V.35 , ISDN , ADSL 등

## 3. OSI 7 계층 vs TCP/IP 계층

OSI 7 계층 이외에도 네트워크 관점의 네트워크 계층이 있다. 네트워크의 개념에서 볼 때 앞에서 언급한 Upper 레이어는 5계층부터 7계층까지를 응용 계층으로 보고 있다.
![alt text](/image/image.png)

네트워크 관점에서 응용 계층 (1.5 ~ 1.7)에서 흐르는 데이터는 데이터 스트림으로 본다. 네트워크 계층에서는 패킷으로 간주하며, 물리와 데이터 링크 계층에서는 프레임으로 간주한다.

## 4. OSI 7 계층 데이터 헤더 구조

OSI 7 계층에서 보는 헤더 구조는 계층별 데이터 사이즈를 달라지게 한다. 예를 들어 사용자 데이터인 Upper 계층 데이터는 순수한 데이터로 보지만 하위 계층으로 내려가면서 TCP 헤더, IP헤더, LLC 헤더 , MAC 헤더가 포함돼 데이터 구조를 이루고 있다.
![alt text](/image/image2.png)

본격적으로 라우팅, 스위칭을 배우기 전에 위와 같은 계층별 데이터 구조를 이해하고 있어야한다.

### 암호화된 패스워드 관리

네트워크 장비의 초기 패스워드는 텍스트 형태로 저장되기 때문에 Configuration 파일이 유출될 경우 네트워크 장비의 접근 패스워드도 함께 유출될 수 있기 때문에 패스워드 저장 시 암호화해 저장해야 한다.

```
- [보안 적용] 시스코 장비 기준
1. password 설정 (텔넷 , 콘솔)
2. enable password 설정
3. enable secret 설정 (enable password 보다 우선 순위임)
4. service password-encryption 설정(패스워드 암호화)

R1# show running-config

Router#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#service password-encryption                // 전체 설정되는 패스워드 암호화 적용
Router(config)#enable password 7 1158481406130A161E6B6A   // 패스워드 암호화
Router(config)#enable secret 7 1158481406130A161E6B6A     // 패스워드 암호화
Router(config)#line con 0
Router(config-line)#exec-timeout 0 0
Router(config-line)#password 7 134456435A1D152B2A3E32
Router(config-line)#loggin synchronous
Router(config-line)#line vty 0 4
Router(config-line)#password 7 1158481406130A161E6B6A
Router(config-line)#loggin
```

### NTP 동기

NTP(Network Time Protocaol) 서버와 타임 동기를 통해 경고나 장애 이벤트가 발생했을 때 연관 시스템 로그와 대조해 원인을 파악하는데 필요하다.

```
- NTP 서버 연동 명령어 (시스코 사 장비 기준)
Router#config terminal
Router(config)#ntp server 128.134.20.100
```

### 미사용 보조 입출력 포트 차단

현재 많은 기업이 사용하고 있는 네트워크 장비들은 Aux 포트 , USB 포트 등 다양한 입출력 포트를 가지고 있다. 초기 설정을 위한 콘솔 포트가 가장 많이 사용되며, AUX와 같은 포트는 거의 사용되지 않는다.
최근 USB 포트를 지원하는 장비는 설정 값 등 로그 정보를 입출력을 위해 많이 사용하고 있다. 설사 사용하더라도 초기에 사용하거나 특별한 경우에만 사용해야 하며, 장비의 정보의 유출이나 비인가 접속으로 인한 장애를 사전에 방지하려면 평상시에 차단하는 것이 좋다.

```
- 미사용 보조 입출력 포트 차단 (시스코 사 장비 기준)
Router#config terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#line aux 0
Router(config-line)#no password // 임의의 사용자 접속 차단
Router(config-line)# transport input none // 임의의 입력 값을 받지 않음
Router(config-line)#no exec // 임의의 명령어 실행 차단
Router(config-line)#exec-timeout 0 1 // 1초후 자동 타임 아웃 설정
```
